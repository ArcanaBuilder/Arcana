#!/usr/bin/arcana

using default interpreter /bin/bash;

import Defaults.arc;


###########################
# BUILT-IN TASKS
###########################

@public
task Clean() 
{ 
    rm -rf {BUILDDIR}
}

@public
@always
@dependecy Build Clean
task Install()
{
    cp {TARGET} /usr/bin/  
}

###########################
# OVERRIDED BUILT-IN TASKS
###########################

@main
@public
@dependecy Compile Link
task Build() {}

@multithread
task Compile()
{
    {COMPILER} {FLAGS} {SOURCES} -c {OBJECTS}
}


task Link()
{
    {COMPILER} {FLAGS} {OBJECTS} -o {TARGET}
}



###########################
# PRE BUILD TASKS
###########################

using order precompiler Message MakeFolders;

@precompiler
task MakeFolders() 
{
    cd SRCDIR
    find . -type d -exec mkdir -p "../{BUILDDIR}"/{} \;
}


@interpreter /bin/python3
@profile Debug
@precompiler
task Message() 
{
print("Compiling {TARGET} in Debug Mode")
}


@profile Release
@precompiler
task Message() 
{
    echo 'Compiling {TARGET} in Release Mode'
}



###########################
# POST BUILD TASKS
###########################

@private
@callable
@postcompiler
task Say_Something(msg) { echo msg }

###########################
# POST BUILD TASKS CALL
###########################

Say_Something('All Done!');