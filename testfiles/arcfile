#!/usr/bin/arcana

using default interpreter /bin/bash;

import Defaults.arc;


###########################
# BUILT-IN TASKS
###########################

@public
task Clean() 
{ 
    rm -rf {arc:BUILDDIR}
}

@public
@always
@dependecy Clean Build
task Install()
{
    cp {arc:TARGET} /usr/bin/  
}

###########################
# OVERRIDED BUILT-IN TASKS
###########################

@public
@dependecy Compile Link
task Build() {}

@public
@main
@multithreading
task Compile()
{
    {arc:COMPILER} {arc:FLAGS} {arc:list:SOURCES} -c {arc:list:OBJECTS}
}


task Link()
{
    {arc:COMPILER} {arc:FLAGS} {arc:inline:OBJECTS} -o {arc:TARGET}
}



###########################
# PRE BUILD TASKS
###########################

using order precompiler Message MakeFolders;

@precompiler
task MakeFolders() 
{
    cd {arc:SRCDIR}
    find . -type d -exec mkdir -p "../{arc:BUILDDIR}"/{} \;
}


@interpreter /bin/python3
@profile Debug
@precompiler
task Message() 
{
print("Compiling {arc:TARGET} in Debug Mode")
}


@profile Release
@precompiler
task Message() 
{
    echo 'Compiling {arc:TARGET} in Release Mode'
}



###########################
# POST BUILD TASKS
###########################

@private
@interpreter /bin/echo
@postcompiler
task Say_Something() 
{ 
    "GATOR!"
}
