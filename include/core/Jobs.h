#ifndef __ARCANA_JOBS_H__
#define __ARCANA_JOBS_H__



///////////////////////////////////////////////////////////////////////////////
// INCLUDES
///////////////////////////////////////////////////////////////////////////////


#include "Defines.h"
#include "Semantic.h"

#include <variant>
#include <unordered_set>


///////////////////////////////////////////////////////////////////////////////
// module namespace
///////////////////////////////////////////////////////////////////////////////

BEGIN_MODULE(Jobs)

USE_MODULE(Arcana);


//         ██  ██████  ██████  ███████     ███████  ██████  ██████  ██     ██  █████  ██████  ██████  ███████ ██████  
//         ██ ██    ██ ██   ██ ██          ██      ██    ██ ██   ██ ██     ██ ██   ██ ██   ██ ██   ██ ██      ██   ██ 
//         ██ ██    ██ ██████  ███████     █████   ██    ██ ██████  ██  █  ██ ███████ ██████  ██   ██ █████   ██   ██ 
//    ██   ██ ██    ██ ██   ██      ██     ██      ██    ██ ██   ██ ██ ███ ██ ██   ██ ██   ██ ██   ██ ██      ██   ██ 
//     █████   ██████  ██████  ███████     ██       ██████  ██   ██  ███ ███  ██   ██ ██   ██ ██████  ███████ ██████  
//                                                                                                                    
//                                                                                                                    
//    ████████ ██    ██ ██████  ███████ ███████                                                                       
//       ██     ██  ██  ██   ██ ██      ██                                                                            
//       ██      ████   ██████  █████   ███████                                                                       
//       ██       ██    ██      ██           ██                                                                       
//       ██       ██    ██      ███████ ███████                                                                       
//                                                                                                                    
//                                                                                                                    

class Job;
class List;



//         ██  ██████  ██████  ███████     ██    ██ ███████ ██ ███    ██  ██████  ███████ 
//         ██ ██    ██ ██   ██ ██          ██    ██ ██      ██ ████   ██ ██       ██      
//         ██ ██    ██ ██████  ███████     ██    ██ ███████ ██ ██ ██  ██ ██   ███ ███████ 
//    ██   ██ ██    ██ ██   ██      ██     ██    ██      ██ ██ ██  ██ ██ ██    ██      ██ 
//     █████   ██████  ██████  ███████      ██████  ███████ ██ ██   ████  ██████  ███████ 
//                                                                                        
//                                                                                        


using GeneratedJobs = std::optional<std::variant<Job, std::vector<Job>>>;




//         ██  ██████  ██████  ███████     ██████  ██    ██ ██████  ██      ██  ██████    
//         ██ ██    ██ ██   ██ ██          ██   ██ ██    ██ ██   ██ ██      ██ ██         
//         ██ ██    ██ ██████  ███████     ██████  ██    ██ ██████  ██      ██ ██         
//    ██   ██ ██    ██ ██   ██      ██     ██      ██    ██ ██   ██ ██      ██ ██         
//     █████   ██████  ██████  ███████     ██       ██████  ██████  ███████ ██  ██████    
//                                                                                        
//                                                                                        
//     █████   ██████   ██████  ██████  ███████  ██████   █████  ████████ ███████ ███████ 
//    ██   ██ ██       ██       ██   ██ ██      ██       ██   ██    ██    ██      ██      
//    ███████ ██   ███ ██   ███ ██████  █████   ██   ███ ███████    ██    █████   ███████ 
//    ██   ██ ██    ██ ██    ██ ██   ██ ██      ██    ██ ██   ██    ██    ██           ██ 
//    ██   ██  ██████   ██████  ██   ██ ███████  ██████  ██   ██    ██    ███████ ███████ 
//                                                                                        
//                                                                                        


class Job
{
    friend class List;

public:
    Job(const Job&) = default;

private:
    Job();
    static GeneratedJobs FromInstruction(const Semantic::InstructionTask& task) noexcept;
    
    std::string            name;
    Semantic::Task::Instrs instructions;
    Semantic::Interpreter  interpreter;
    bool                   parallelizable;
};


class List
{
public:
    List(const List&) = default;

    static List              FromEnv(Semantic::Enviroment& environment) noexcept;
    const  std::vector<Job>& All() const noexcept { return data; }

private:
    List();
    void Insert(Job&               j);
    void Insert(std::vector<Job>& vj);
    void Insert(GeneratedJobs     gj);
    
    std::unordered_set<std::string> index;
    std::vector<Job>                data;
};





//         ██  ██████  ██████  ███████     ██████  ██    ██ ██████  ██      ██  ██████ 
//         ██ ██    ██ ██   ██ ██          ██   ██ ██    ██ ██   ██ ██      ██ ██      
//         ██ ██    ██ ██████  ███████     ██████  ██    ██ ██████  ██      ██ ██      
//    ██   ██ ██    ██ ██   ██      ██     ██      ██    ██ ██   ██ ██      ██ ██      
//     █████   ██████  ██████  ███████     ██       ██████  ██████  ███████ ██  ██████ 
//                                                                                     
//                                                                                     
//    ███████ ██    ██ ███    ██  ██████ ████████ ██  ██████  ███    ██ ███████        
//    ██      ██    ██ ████   ██ ██         ██    ██ ██    ██ ████   ██ ██             
//    █████   ██    ██ ██ ██  ██ ██         ██    ██ ██    ██ ██ ██  ██ ███████        
//    ██      ██    ██ ██  ██ ██ ██         ██    ██ ██    ██ ██  ██ ██      ██        
//    ██       ██████  ██   ████  ██████    ██    ██  ██████  ██   ████ ███████        
//                                                                                     
//                                                                                     


END_MODULE(Jobs)




#endif /* __ARCANA_JOBS_H__ */