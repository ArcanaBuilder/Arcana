///////////////////////////////////////////////////////////////////////////////
// INCLUDES
///////////////////////////////////////////////////////////////////////////////

#include "Defines.h"
#include "Support.h"
#include "Parser.h"

#include <fstream>
#include <iostream>


///////////////////////////////////////////////////////////////////////////////
// USING
///////////////////////////////////////////////////////////////////////////////

USE_MODULE(Arcana);



///////////////////////////////////////////////////////////////////////////////
// PUBLIC PROTOS
///////////////////////////////////////////////////////////////////////////////




///////////////////////////////////////////////////////////////////////////////
// PRIVATE PROTOS
///////////////////////////////////////////////////////////////////////////////

static ERROR_CODE run(const Support::Arguments& args);




///////////////////////////////////////////////////////////////////////////////
// MAIN
///////////////////////////////////////////////////////////////////////////////

int main(int argc, char** argv) 
{   
    Support::Arguments args = Support::ParseArgs(argc, argv);

    if (args.size() < 2)
    {
        ERR("Required at least one argument, the arcana-script file!");
        return ERROR_CODE__INVALID_ARGS;
    }

    return run(args);
}


///////////////////////////////////////////////////////////////////////////////
// PRIVATE FUNCTIONS
///////////////////////////////////////////////////////////////////////////////

static ERROR_CODE run(const Support::Arguments& args)
{   
    std::ifstream file(args[1].arg);

    Scan::Lexer       lexer(file);
    Grammar::Engine   engine;
    Parsing::Parser   parser(lexer, engine);

    parser.AddErrorCallback(Support::ParserError {lexer} );
    parser.parse();

    return ERROR_CODE__OK;
}